<html>
  <head>
    <title>TENACITY</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <script>
      function SfxrP() {
        this.set = function (e) {
          for (var t = 0; t < 24; t++)
            this[String.fromCharCode(97 + t)] = e[t] || 0;
          this.c < 0.01 && (this.c = 0.01);
          var r = this.b + this.c + this.e;
          if (r < 0.18) {
            var a = 0.18 / r;
            (this.b *= a), (this.c *= a), (this.e *= a);
          }
        };
      }
      function sy() {
        var e, t, r, a, l, o, i, n, g, s, f, u;
        (this._p = new SfxrP()),
          (this.reset = function () {
            var e = this._p;
            (a = 100 / (e.f * e.f + 0.001)),
              (l = 100 / (e.g * e.g + 0.001)),
              (o = 1 - e.h * e.h * e.h * 0.01),
              (i = -e.i * e.i * e.i * 1e-6),
              e.a || ((f = 0.5 - e.n / 2), (u = 5e-5 * -e.o)),
              (n = 1 + e.l * e.l * (e.l > 0 ? -0.9 : 10)),
              (g = 0),
              (s = 1 == e.m ? 0 : (1 - e.m) * (1 - e.m) * 2e4 + 32);
          }),
          (this.totalReset = function () {
            this.reset();
            var a = this._p;
            return (
              (e = a.b * a.b * 1e5),
              (t = a.c * a.c * 1e5),
              (r = a.e * a.e * 1e5 + 12),
              3 * (((e + t + r) / 3) | 0)
            );
          }),
          (this.sW = function (d, y) {
            var c = this._p,
              b = 1 != c.s || c.v,
              h = c.v * c.v * 0.1,
              v = 1 + 3e-4 * c.w,
              m = c.s * c.s * c.s * 0.1,
              x = 1 + 1e-4 * c.t,
              p = 1 != c.s,
              E = c.x * c.x,
              T = c.g,
              w = c.q || c.r,
              R = c.r * c.r * c.r * 0.2,
              _ = c.q * c.q * (c.q < 0 ? -1020 : 1020),
              A = c.p ? 32 + (((1 - c.p) * (1 - c.p) * 2e4) | 0) : 0,
              M = c.d,
              z = c.j / 2,
              U = c.k * c.k * 0.01,
              C = c.a,
              j = e,
              S = 1 / e,
              X = 1 / t,
              D = 1 / r,
              B = (5 / (1 + c.u * c.u * 20)) * (0.01 + m);
            B > 0.8 && (B = 0.8), (B = 1 - B);
            for (
              var I,
                F,
                L,
                P,
                H,
                N,
                G = !1,
                Z = 0,
                O = 0,
                Y = 0,
                W = 0,
                V = 0,
                k = 0,
                q = 0,
                J = 0,
                K = 0,
                Q = 0,
                $ = new Array(1024),
                ee = new Array(32),
                te = $.length;
              te--;

            )
              $[te] = 0;
            for (te = ee.length; te--; ) ee[te] = 2 * Math.random() - 1;
            for (te = 0; te < y; te++) {
              if (G) return te;
              if (
                (A && ++K >= A && ((K = 0), this.reset()),
                s && ++g >= s && ((s = 0), (a *= n)),
                (a *= o += i) > l && ((a = l), T > 0 && (G = !0)),
                (F = a),
                z > 0 && ((Q += U), (F *= 1 + Math.sin(Q) * z)),
                (F |= 0) < 8 && (F = 8),
                C || ((f += u) < 0 ? (f = 0) : f > 0.5 && (f = 0.5)),
                ++O > j)
              )
                switch (((O = 0), ++Z)) {
                  case 1:
                    j = t;
                    break;
                  case 2:
                    j = r;
                }
              switch (Z) {
                case 0:
                  Y = O * S;
                  break;
                case 1:
                  Y = 1 + 2 * (1 - O * X) * M;
                  break;
                case 2:
                  Y = 1 - O * D;
                  break;
                case 3:
                  (Y = 0), (G = !0);
              }
              w && ((L = 0 | (_ += R)) < 0 ? (L = -L) : L > 1023 && (L = 1023)),
                b && v && ((h *= v) < 1e-5 ? (h = 1e-5) : h > 0.1 && (h = 0.1)),
                (N = 0);
              for (var re = 8; re--; ) {
                if (++q >= F && ((q %= F), 3 == C))
                  for (var ae = ee.length; ae--; )
                    ee[ae] = 2 * Math.random() - 1;
                switch (C) {
                  case 0:
                    H = q / F < f ? 0.5 : -0.5;
                    break;
                  case 1:
                    H = 1 - (q / F) * 2;
                    break;
                  case 2:
                    H =
                      0.225 *
                        (((H =
                          1.27323954 *
                            (P = 6.28318531 * ((P = q / F) > 0.5 ? P - 1 : P)) +
                          0.405284735 * P * P * (P < 0 ? 1 : -1)) < 0
                          ? -1
                          : 1) *
                          H *
                          H -
                          H) +
                      H;
                    break;
                  case 3:
                    H = ee[Math.abs(((32 * q) / F) | 0)];
                }
                b &&
                  ((I = k),
                  (m *= x) < 0 ? (m = 0) : m > 0.1 && (m = 0.1),
                  p ? ((V += (H - k) * m), (V *= B)) : ((k = H), (V = 0)),
                  (W += (k += V) - I),
                  (H = W *= 1 - h)),
                  w &&
                    (($[J % 1024] = H), (H += $[(J - L + 1024) % 1024]), J++),
                  (N += H);
              }
              (N *= 0.125 * Y * E), (d[te] = N >= 1 ? 1 : N <= -1 ? -1 : N);
            }
            return y;
          });
      }
      var synth = new sy();
      (window.jsfxr = function (e) {
        window._audioContext = window._audioContext || new AudioContext();
        var t = window._audioContext;
        synth._p.set(e);
        var r = synth.totalReset(),
          a = ((r + 1) >> 1) << 1,
          l = t.createBuffer(1, a, t.sampleRate),
          o = l.getChannelData(0);
        return synth.sW(o, r), l;
      }),
        (window.playSound = function (e) {
          if (sound) {
            jsfxr(e);
            var t = window._audioContext,
              r = t.createBufferSource();
            return (
              (r.buffer = jsfxr(e)),
              (r.loop = !1),
              r.connect(t.destination),
              r.start(t.currentTime),
              [r.buffer, t, r]
            );
          }
        }),
        (glMatrixArrayType =
          "undefined" != typeof Float32Array
            ? Float32Array
            : "undefined" != typeof WebGLFloatArray
            ? WebGLFloatArray
            : Array);
      var crate,
        noise,
        mur,
        camera,
        cubeVertexIndexBuffer,
        levels,
        mat3 = {
          create: function (e) {
            var t = new glMatrixArrayType(9);
            return (
              e &&
                ((t[0] = e[0]),
                (t[1] = e[1]),
                (t[2] = e[2]),
                (t[3] = e[3]),
                (t[4] = e[4]),
                (t[5] = e[5]),
                (t[6] = e[6]),
                (t[7] = e[7]),
                (t[8] = e[8]),
                (t[9] = e[9])),
              t
            );
          },
          transpose: function (e, t) {
            if (!t || e == t) {
              var r = e[1],
                a = e[2],
                l = e[5];
              return (
                (e[1] = e[3]),
                (e[2] = e[6]),
                (e[3] = r),
                (e[5] = e[7]),
                (e[6] = a),
                (e[7] = l),
                e
              );
            }
            return (
              (t[0] = e[0]),
              (t[1] = e[3]),
              (t[2] = e[6]),
              (t[3] = e[1]),
              (t[4] = e[4]),
              (t[5] = e[7]),
              (t[6] = e[2]),
              (t[7] = e[5]),
              (t[8] = e[8]),
              t
            );
          },
        },
        mat4 = {
          create: function (e) {
            var t = new glMatrixArrayType(16);
            return (
              e &&
                ((t[0] = e[0]),
                (t[1] = e[1]),
                (t[2] = e[2]),
                (t[3] = e[3]),
                (t[4] = e[4]),
                (t[5] = e[5]),
                (t[6] = e[6]),
                (t[7] = e[7]),
                (t[8] = e[8]),
                (t[9] = e[9]),
                (t[10] = e[10]),
                (t[11] = e[11]),
                (t[12] = e[12]),
                (t[13] = e[13]),
                (t[14] = e[14]),
                (t[15] = e[15])),
              t
            );
          },
          identity: function (e) {
            return (
              (e[0] = 1),
              (e[1] = 0),
              (e[2] = 0),
              (e[3] = 0),
              (e[4] = 0),
              (e[5] = 1),
              (e[6] = 0),
              (e[7] = 0),
              (e[8] = 0),
              (e[9] = 0),
              (e[10] = 1),
              (e[11] = 0),
              (e[12] = 0),
              (e[13] = 0),
              (e[14] = 0),
              (e[15] = 1),
              e
            );
          },
          toInverseMat3: function (e, t) {
            var r = e[0],
              a = e[1],
              l = e[2],
              o = e[4],
              i = e[5],
              n = e[6],
              g = e[8],
              s = e[9],
              f = e[10],
              u = f * i - n * s,
              d = -f * o + n * g,
              y = s * o - i * g,
              c = r * u + a * d + l * y;
            return c
              ? ((c = 1 / c),
                t || (t = mat3.create()),
                (t[0] = u * c),
                (t[1] = (-f * a + l * s) * c),
                (t[2] = (n * a - l * i) * c),
                (t[3] = d * c),
                (t[4] = (f * r - l * g) * c),
                (t[5] = (-n * r + l * o) * c),
                (t[6] = y * c),
                (t[7] = (-s * r + a * g) * c),
                (t[8] = (i * r - a * o) * c),
                t)
              : null;
          },
          translate: function (e, t, r) {
            var a = t[0],
              l = t[1];
            if (((t = t[2]), !r || e == r))
              return (
                (e[12] = e[0] * a + e[4] * l + e[8] * t + e[12]),
                (e[13] = e[1] * a + e[5] * l + e[9] * t + e[13]),
                (e[14] = e[2] * a + e[6] * l + e[10] * t + e[14]),
                (e[15] = e[3] * a + e[7] * l + e[11] * t + e[15]),
                e
              );
            var o = e[0],
              i = e[1],
              n = e[2],
              g = e[3],
              s = e[4],
              f = e[5],
              u = e[6],
              d = e[7],
              y = e[8],
              c = e[9],
              b = e[10],
              h = e[11];
            return (
              (r[0] = o),
              (r[1] = i),
              (r[2] = n),
              (r[3] = g),
              (r[4] = s),
              (r[5] = f),
              (r[6] = u),
              (r[7] = d),
              (r[8] = y),
              (r[9] = c),
              (r[10] = b),
              (r[11] = h),
              (r[12] = o * a + s * l + y * t + e[12]),
              (r[13] = i * a + f * l + c * t + e[13]),
              (r[14] = n * a + u * l + b * t + e[14]),
              (r[15] = g * a + d * l + h * t + e[15]),
              r
            );
          },
          rotate: function (e, t, r, a) {
            var l = r[0],
              o = r[1];
            r = r[2];
            var i = Math.sqrt(l * l + o * o + r * r);
            if (!i) return null;
            1 != i && ((l *= i = 1 / i), (o *= i), (r *= i));
            var n = Math.sin(t),
              g = Math.cos(t),
              s = 1 - g;
            (t = e[0]), (i = e[1]);
            var f = e[2],
              u = e[3],
              d = e[4],
              y = e[5],
              c = e[6],
              b = e[7],
              h = e[8],
              v = e[9],
              m = e[10],
              x = e[11],
              p = l * l * s + g,
              E = o * l * s + r * n,
              T = r * l * s - o * n,
              w = l * o * s - r * n,
              R = o * o * s + g,
              _ = r * o * s + l * n,
              A = l * r * s + o * n;
            return (
              (l = o * r * s - l * n),
              (o = r * r * s + g),
              a
                ? e != a &&
                  ((a[12] = e[12]),
                  (a[13] = e[13]),
                  (a[14] = e[14]),
                  (a[15] = e[15]))
                : (a = e),
              (a[0] = t * p + d * E + h * T),
              (a[1] = i * p + y * E + v * T),
              (a[2] = f * p + c * E + m * T),
              (a[3] = u * p + b * E + x * T),
              (a[4] = t * w + d * R + h * _),
              (a[5] = i * w + y * R + v * _),
              (a[6] = f * w + c * R + m * _),
              (a[7] = u * w + b * R + x * _),
              (a[8] = t * A + d * l + h * o),
              (a[9] = i * A + y * l + v * o),
              (a[10] = f * A + c * l + m * o),
              (a[11] = u * A + b * l + x * o),
              a
            );
          },
          frustum: function (e, t, r, a, l, o, i) {
            i || (i = mat4.create());
            var n = t - e,
              g = a - r,
              s = o - l;
            return (
              (i[0] = (2 * l) / n),
              (i[1] = 0),
              (i[2] = 0),
              (i[3] = 0),
              (i[4] = 0),
              (i[5] = (2 * l) / g),
              (i[6] = 0),
              (i[7] = 0),
              (i[8] = (t + e) / n),
              (i[9] = (a + r) / g),
              (i[10] = -(o + l) / s),
              (i[11] = -1),
              (i[12] = 0),
              (i[13] = 0),
              (i[14] = (-o * l * 2) / s),
              (i[15] = 0),
              i
            );
          },
          perspective: function (e, t, r, a, l) {
            return (
              (t *= e = r * Math.tan((e * Math.PI) / 360)),
              mat4.frustum(-t, t, -e, e, r, a, l)
            );
          },
          invert: function (e, t) {
            var r = t[0],
              a = t[1],
              l = t[2],
              o = t[3],
              i = t[4],
              n = t[5],
              g = t[6],
              s = t[7],
              f = t[8],
              u = t[9],
              d = t[10],
              y = t[11],
              c = t[12],
              b = t[13],
              h = t[14],
              v = t[15],
              m = r * n - a * i,
              x = r * g - l * i,
              p = r * s - o * i,
              E = a * g - l * n,
              T = a * s - o * n,
              w = l * s - o * g,
              R = f * b - u * c,
              _ = f * h - d * c,
              A = f * v - y * c,
              M = u * h - d * b,
              z = u * v - y * b,
              U = d * v - y * h,
              C = m * U - x * z + p * M + E * A - T * _ + w * R;
            return C
              ? ((C = 1 / C),
                (e[0] = (n * U - g * z + s * M) * C),
                (e[1] = (l * z - a * U - o * M) * C),
                (e[2] = (b * w - h * T + v * E) * C),
                (e[3] = (d * T - u * w - y * E) * C),
                (e[4] = (g * A - i * U - s * _) * C),
                (e[5] = (r * U - l * A + o * _) * C),
                (e[6] = (h * p - c * w - v * x) * C),
                (e[7] = (f * w - d * p + y * x) * C),
                (e[8] = (i * z - n * A + s * R) * C),
                (e[9] = (a * A - r * z - o * R) * C),
                (e[10] = (c * T - b * p + v * m) * C),
                (e[11] = (u * p - f * T - y * m) * C),
                (e[12] = (n * _ - i * M - g * R) * C),
                (e[13] = (r * M - a * _ + l * R) * C),
                (e[14] = (b * x - c * E - h * m) * C),
                (e[15] = (f * E - u * x + d * m) * C),
                e)
              : null;
          },
          transpose: function (e, t) {
            if (e === t) {
              var r = t[1],
                a = t[2],
                l = t[3],
                o = t[6],
                i = t[7],
                n = t[11];
              (e[1] = t[4]),
                (e[2] = t[8]),
                (e[3] = t[12]),
                (e[4] = r),
                (e[6] = t[9]),
                (e[7] = t[13]),
                (e[8] = a),
                (e[9] = o),
                (e[11] = t[14]),
                (e[12] = l),
                (e[13] = i),
                (e[14] = n);
            } else
              (e[0] = t[0]),
                (e[1] = t[4]),
                (e[2] = t[8]),
                (e[3] = t[12]),
                (e[4] = t[1]),
                (e[5] = t[5]),
                (e[6] = t[9]),
                (e[7] = t[13]),
                (e[8] = t[2]),
                (e[9] = t[6]),
                (e[10] = t[10]),
                (e[11] = t[14]),
                (e[12] = t[3]),
                (e[13] = t[7]),
                (e[14] = t[11]),
                (e[15] = t[15]);
            return e;
          },
        },
        sound = !0,
        UVW = [],
        mvMatrixShadow = mat4.create(),
        mvMatrix = mat4.create(),
        pMatrix = mat4.create(),
        frame = 0,
        UVWBuffer = [],
        coordBuffer = [],
        font = [];
      function drawText(e, t, r, a) {
        var l = ["#000", "#FFF"];
        (a = (a * canvas.width) / 3840),
          (e *= canvas.width / 1920),
          (t *= canvas.height / 1080);
        for (var o = 0; o < l.length; o++) {
          (ctx.fillStyle = l[o]),
            0 != o && ((e -= gameStarted ? 2 : 4), (t -= gameStarted ? 2 : 4));
          for (var i = e, n = t, g = 0; g < r.length; g++) {
            var s = 0;
            if ("&" != r[g]) {
              for (y = 0; y < 7; y++)
                for (x = 0; x < 5; x++)
                  " " != r[g] &&
                    ("0" != font[r[g]][s] &&
                      ctx.fillRect(
                        i + 2 * x * a,
                        n +
                          2 * y * a +
                          (gameStarted
                            ? 0
                            : 5 *
                              Math.sin(
                                (i + (0 != o ? 4 : 0)) / a + frame / 20
                              )),
                        3 * a,
                        3 * a
                      ),
                    s++);
              i += 12 * a;
            } else (i = e), (n += 2 * a * 12);
          }
        }
      }
      function getShader(e) {
        var t = document.getElementById(e),
          r = gl.createShader(
            t.type.indexOf("frag") > -1 ? gl.FRAGMENT_SHADER : gl.VERTEX_SHADER
          );
        return (
          gl.shaderSource(r, document.getElementById(e).innerText),
          gl.compileShader(r),
          gl.getShaderParameter(r, gl.COMPILE_STATUS)
            ? r
            : (alert(t.type + gl.getShaderInfoLog(r)), null)
        );
      }
      function initShaders() {
        for (var e = ["Camera", "Shadow"], t = 0; t < e.length; t++) {
          var r = gl.createProgram();
          gl.attachShader(r, getShader("vertexShader" + e[t])),
            gl.attachShader(r, getShader("fragmentShader" + e[t])),
            gl.linkProgram(r),
            gl.useProgram(r),
            (r.vertexPositionAttribute = gl.getAttribLocation(
              r,
              "vertexPosition"
            )),
            gl.enableVertexAttribArray(r.vertexPositionAttribute),
            (r.textureCoordAttribute = gl.getAttribLocation(
              r,
              "aTextureCoord"
            )),
            gl.enableVertexAttribArray(r.textureCoordAttribute),
            (r.normalAttribute = gl.getAttribLocation(r, "aVertexNormal")),
            gl.enableVertexAttribArray(r.normalAttribute),
            (r.worldPosition = gl.getUniformLocation(r, "worldPosition")),
            (r.endPosition = gl.getUniformLocation(r, "endPosition")),
            (r.u_Shadowmap_transform = gl.getUniformLocation(
              r,
              "u_Shadowmap_transform"
            )),
            (r.it = gl.getUniformLocation(r, "it")),
            (r.isPlayer = gl.getUniformLocation(r, "isPlayer")),
            (r.objectType = gl.getUniformLocation(r, "objectType")),
            (r.isGround = gl.getUniformLocation(r, "isGround")),
            (r.pMatrixUniform = gl.getUniformLocation(r, "uPMatrix")),
            (r.mvMatrixUniform = gl.getUniformLocation(r, "uMVMatrix")),
            (r.lightMatrix = gl.getUniformLocation(r, "lightMatrix")),
            (r.nMatrixUniform = gl.getUniformLocation(r, "uNormalMatrix")),
            (r.textureID = gl.getUniformLocation(r, "textureID")),
            (r.depthTextureID = gl.getUniformLocation(r, "depthTextureID")),
            (r.isCurrentPlayer = gl.getUniformLocation(r, "isCurrentPlayer")),
            (r.level = gl.getUniformLocation(r, "level")),
            (r.resolution = gl.getUniformLocation(r, "resolution")),
            (r.levelSize = gl.getUniformLocation(r, "levelSize")),
            (window["shader" + e[t]] = r);
        }
        initBuffers();
      }
      function img2texture(e, t) {
        var r = gl.createTexture();
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, !0),
          gl.bindTexture(gl.TEXTURE_2D, r),
          gl.texImage2D(
            gl.TEXTURE_2D,
            0,
            gl.RGBA,
            gl.RGBA,
            gl.UNSIGNED_BYTE,
            t
          ),
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR),
          gl.texParameteri(
            gl.TEXTURE_2D,
            gl.TEXTURE_MIN_FILTER,
            gl.LINEAR_MIPMAP_NEAREST
          ),
          gl.generateMipmap(gl.TEXTURE_2D),
          (window[e] = r);
      }
      function initBuffers() {
        (cubeVertexIndexBuffer = gl.createBuffer()),
          gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, cubeVertexIndexBuffer),
          gl.bufferData(
            gl.ELEMENT_ARRAY_BUFFER,
            new Uint16Array([
              0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13,
              14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23,
            ]),
            gl.STATIC_DRAW
          );
      }
      (font[0] = "01110100011001110101110011000101110"),
        (font[1] = "00100011000010000100001000010001110"),
        (font[2] = "01110100010000100110010001000011111"),
        (font[3] = "01110100010000100110000011000101110"),
        (font[4] = "00010001100101010010111110001000010"),
        (font[5] = "11111100001111000001000011000101110"),
        (font[6] = "00110010001000011110100011000101110"),
        (font[7] = "11111000010001000100010000100001000"),
        (font[8] = "01110100011000101110100011000101110"),
        (font[9] = "01110100011000101111000010001001100"),
        (font.A = "00100010101000110001111111000110001"),
        (font.B = "11110010010100101110010010100111110"),
        (font.C = "01110100011000010000100001000101110"),
        (font.D = "11110010010100101001010010100111110"),
        (font.E = "11111100001000011110100001000011111"),
        (font.F = "11111100001000011110100001000010000"),
        (font.G = "01110100011000010011100011000101111"),
        (font.H = "10001100011000111111100011000110001"),
        (font.I = "01110001000010000100001000010001110"),
        (font.J = "00111000100010000100001001001001100"),
        (font.K = "10001100101010011000101001001010001"),
        (font.L = "10000100001000010000100001000011111"),
        (font.M = "10001110111010110101100011000110001"),
        (font.N = "10001100011100110101100111000110001"),
        (font.O = "01110100011000110001100011000101110"),
        (font.P = "11110100011000111110100001000010000"),
        (font.Q = "01110100011000110001101011001001101"),
        (font.R = "11110100011000111110101001001010001"),
        (font.S = "01110100011000001110000011000101110"),
        (font.T = "11111001000010000100001000010000100"),
        (font.U = "10001100011000110001100011000101110"),
        (font.V = "10001100011000110001100010101000100"),
        (font.W = "10001100011000110101101011010101010"),
        (font.X = "10001100010101000100010101000110001"),
        (font.Y = "10001100011000101010001000010000100"),
        (font.Z = "11111000010001000100010001000011111"),
        (font["-"] = "00000000000000011111000000000000000"),
        (font["."] = "00000000000000000000000000011000110"),
        (font[","] = "00000000000000000000000110000100010"),
        (font["!"] = "00100001000010000100001000000000100"),
        (font["("] = "00010001000100001000010000010000010"),
        (font[")"] = "00100000100000100001000010001000100"),
        (getCube = function (e, t, r) {
          return [
            -e,
            -t,
            r,
            e,
            -t,
            r,
            e,
            t,
            r,
            -e,
            t,
            r,
            -e,
            -t,
            -r,
            -e,
            t,
            -r,
            e,
            t,
            -r,
            e,
            -t,
            -r,
            -e,
            t,
            -r,
            -e,
            t,
            r,
            e,
            t,
            r,
            e,
            t,
            -r,
            -e,
            -t,
            -r,
            e,
            -t,
            -r,
            e,
            -t,
            r,
            -e,
            -t,
            r,
            e,
            -t,
            -r,
            e,
            t,
            -r,
            e,
            t,
            r,
            e,
            -t,
            r,
            -e,
            -t,
            -r,
            -e,
            -t,
            r,
            -e,
            t,
            r,
            -e,
            t,
            -r,
          ];
        }),
        (getUVW = function (e, t, r, a) {
          return [
            0,
            0,
            (t *= 2),
            0,
            t,
            (r *= 2),
            0,
            r,
            0,
            1,
            0,
            0,
            1,
            0,
            1,
            1,
            0,
            (a *= 2),
            0,
            0,
            t,
            0,
            t,
            a,
            0,
            0,
            1,
            0,
            1,
            r,
            0,
            r,
            0,
            0,
            r,
            0,
            r,
            a,
            0,
            a,
            0,
            0,
            a,
            0,
            a,
            r,
            0,
            r,
          ];
        }),
        (copyGeometryInAttribute = function (e, t, r, a) {
          coordBuffer[t] || (coordBuffer[t] = []),
            coordBuffer[t][r] ||
              ((coordBuffer[t][r] = gl.createBuffer()),
              gl.bindBuffer(gl.ARRAY_BUFFER, coordBuffer[t][r]),
              gl.bufferData(
                gl.ARRAY_BUFFER,
                new Float32Array(a),
                gl.STATIC_DRAW
              ),
              (coordBuffer[t][r].itemSize = 3)),
            gl.bindBuffer(gl.ARRAY_BUFFER, coordBuffer[t][r]),
            gl.vertexAttribPointer(
              e.vertexPositionAttribute,
              coordBuffer[t][r].itemSize,
              gl.FLOAT,
              !1,
              0,
              0
            );
        }),
        (copyUVWInAttribute = function (e, t, r, a, l) {
          var o = r + "_" + a + "_" + l;
          if ((UVWBuffer[t] || (UVWBuffer[t] = []), !UVWBuffer[t][o])) {
            var i = new Float32Array(getUVW(t, r, a, l));
            (UVWBuffer[t][o] = gl.createBuffer()),
              gl.bindBuffer(gl.ARRAY_BUFFER, UVWBuffer[t][o]),
              gl.bufferData(gl.ARRAY_BUFFER, i, gl.STATIC_DRAW),
              (UVWBuffer[t][o].itemSize = 2);
          }
          gl.bindBuffer(gl.ARRAY_BUFFER, UVWBuffer[t][o]),
            gl.vertexAttribPointer(
              e.textureCoordAttribute,
              UVWBuffer[t][o].itemSize,
              gl.FLOAT,
              !1,
              0,
              0
            );
        }),
        (copyNormalsInAttribute = function (e) {
          var t = gl.createBuffer();
          gl.bindBuffer(gl.ARRAY_BUFFER, t);
          var r = new Float32Array([
            0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0,
            0, -1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0,
            -1, 0, 0, -1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1,
            0, 0, -1, 0, 0, -1, 0, 0,
          ]);
          gl.bufferData(gl.ARRAY_BUFFER, r, gl.STATIC_DRAW),
            gl.bindBuffer(gl.ARRAY_BUFFER, t),
            gl.vertexAttribPointer(e.normalAttribute, 3, gl.FLOAT, !1, 0, 0);
        });
      var light = { x: 11, y: 15, z: 15, rotation: { x: 0.7, y: -0.5, z: 0 } },
        cameraX = 0,
        cameraZ = 0,
        cameraY = 0,
        cameraRotationX = 0,
        cameraRotationY = 0,
        cameraRotationZ = 0;
      function getMatrix(e, t) {
        var r = mat4.create();
        return (
          mat4.identity(r),
          mat4.rotate(r, e.rotation.x, [1, 0, 0]),
          mat4.rotate(r, e.rotation.y, [0, 1, 0]),
          mat4.rotate(r, e.rotation.z, [0, 0, 1]),
          "player" == t.type
            ? (mat4.translate(r, [
                player.x - e.x,
                player.y - e.y,
                player.z - e.z,
              ]),
              t.rotation &&
                (mat4.rotate(r, t.rotation.x, [1, 0, 0]),
                mat4.rotate(r, t.rotation.y, [0, 1, 0]),
                mat4.rotate(r, t.rotation.z, [0, 0, 1])),
              mat4.translate(r, [t.x, t.y, t.z]))
            : (mat4.translate(r, [t.x - e.x, t.y - e.y, t.z - e.z]),
              t.rotation &&
                (mat4.rotate(r, t.rotation.x, [1, 0, 0]),
                mat4.rotate(r, t.rotation.y, [0, 1, 0]),
                mat4.rotate(r, t.rotation.z, [0, 0, 1]))),
          r
        );
      }
      var player,
        levelEnCours = 0,
        robot = [
          [0, 0.05, -0.15, 0.05, 0.25, 0.1],
          [0, 0.05, 0.15, 0.05, 0.25, 0.1],
          [0, 0.15, 0.1, 0.15, 0.15, 0.05],
          [0, 0.15, -0.1, 0.15, 0.15, 0.05],
          [0.15, 0.45, 0.3, 0.05, 0.2, 0.05],
          [0.2, 0.45, -0.3, 0.05, 0.2, 0.05],
          [0.4, 0.45, 0.3, 0.15, 0.05, 0.05],
          [0.4, 0.45, -0.3, 0.15, 0.05, 0.05],
          [0, 0.4, 0, 0.2, 0.25, 0.25],
          [0, 0.65, 0, 0.05, 0.15, 0.15],
        ];
      getLevel = function (e, t, r, a) {
        (e = (e + 0.5) | 0), (t = (t + 0.5) | 0);
        var l = -1,
          o = -1;
        ("level" != r && "all" != r) ||
          (1 == (l = levels[levelEnCours].tiles[t][e].h) && (l = 0));
        var i = null;
        if ("objects" == r || "all" == r)
          for (var n of levels[levelEnCours].objects)
            n == a ||
              n.disabled ||
              "wall2" == n.type ||
              (n.x == e &&
                n.z == t &&
                n.y + 0.5 > o &&
                ((o = n.y + 0.5), (i = n)));
        return { level: Math.max(l, o), o: i };
      };
      var canvas,
        shadow_frame_buffer,
        canvasHUD,
        copyNormalDone = !1,
        gameStarted = !1;
      function render() {
        if (
          (frame++,
          ctx.clearRect(0, 0, window.innerWidth, window.innerHeight),
          12 == levelEnCours)
        )
          drawText(850, 600, "YOU ARE TENACIOUS !", 8),
            drawText(800, 300, "CONGRATULATIONS !", 10);
        else if (gameStarted) {
          drawText(
            960 - ((a = "STAGE " + levelEnCours).length / 2) * 27,
            20,
            a,
            4.5
          ),
            drawText(10, 100, "M - MUTE&R - RETRY", 3);
        } else
          drawText(925, 200, "TENACITY", 16),
            drawText(850, 800, "PRESS A KEY TO START", 8);
        if ((requestAnimationFrame(render), player.inMove)) {
          var e = (player.x + 0.5) | 0,
            t = (player.z + 0.5) | 0;
          if (Math.abs(player.x - player.targetX) > 0.01)
            player.pushObj &&
              (player.pushObj.x += player.x - player.targetX > 0 ? -0.1 : 0.1),
              (player.x += player.x - player.targetX > 0 ? -0.1 : 0.1);
          else if (Math.abs(player.z - player.targetZ) > 0.01)
            player.pushObj &&
              (player.pushObj.z += player.z - player.targetZ > 0 ? -0.1 : 0.1),
              (player.z += player.z - player.targetZ > 0 ? -0.1 : 0.1);
          else if (
            ((player.inMove = !1),
            ((player.x + 0.5) | 0) == levels[levelEnCours].end[0] &&
              ((player.z + 0.5) | 0) == levels[levelEnCours].end[2])
          )
            return (
              playSound([
                0, 0, 0, 0, 1, 0.3037428222585762, 0, 0.3508811080179185, 0, 0,
                0, 0.015, 0, 0.35590201182028414, 0, 0.484, 0, 0, 1, 0, 0, 0, 0,
                0.25,
              ]),
              levelEnCours++,
              void initLevels()
            );
          var a,
            o = (player.x + 0.5) | 0,
            i = (player.z + 0.5) | 0;
          if (e != o || t != i)
            (a = levels[levelEnCours].tiles[t][e].t) &&
              a.y == player.y &&
              a.trigger(!1),
              (a = levels[levelEnCours].tiles[i][o].t) && a.trigger(!0);
          if (!player.inMove && player.pushObj)
            (player.pushObj.x = (player.pushObj.x + 0.5) | 0),
              (player.pushObj.z = (player.pushObj.z + 0.5) | 0),
              (a =
                levels[levelEnCours].tiles[(player.pushObj.z + 0.5) | 0][
                  (player.pushObj.x + 0.5) | 0
                ].t) && a.trigger(!0),
              (player.pushObj = !1);
        }
        for (var n = 0; n < levels[levelEnCours].height; n++)
          for (var g = 0; g < levels[levelEnCours].width; g++) {
            var s = levels[levelEnCours].tiles[n][g].h;
            !1 !== levels[levelEnCours].tiles[n][g].targetH &&
              (Math.abs(levels[levelEnCours].tiles[n][g].targetH - s) > 0.01
                ? ((s +=
                    levels[levelEnCours].tiles[n][g].targetH > s ? 0.1 : -0.1),
                  (levels[levelEnCours].tiles[n][g].h = s))
                : ((levels[levelEnCours].tiles[n][g].h = (s + 0.5) | 0),
                  (levels[levelEnCours].tiles[n][g].targetH = !1)));
          }
        for (var f of ((player.targetY = getLevel(
          player.x,
          player.z,
          "all"
        ).level),
        player.y < player.targetY
          ? ((player.y = player.targetY), (player.G = 0))
          : player.y > player.targetY &&
            (0 == player.G && (player.G = 0.1),
            (player.G *= 1.05),
            (player.y += player.y > player.targetY ? -player.G : player.G),
            player.y < player.targetY &&
              ((player.y = player.targetY), (player.G = 0))),
        levels[levelEnCours].objects))
          "wall" != f.type &&
            "wall2" != f.type &&
            ((f.targetY = getLevel(f.x, f.z, "all", f).level + 0.5),
            f.y - f.targetY > 0.01
              ? ((f.G += 0.01),
                (f.y += f.y > f.targetY ? -f.G : f.G),
                (f.y = Math.max(f.y, f.targetY)))
              : ((f.y = f.targetY - f.y < 1 ? f.targetY : f.y), (f.G = 0)));
        if (
          (player.y <= 0 &&
            (drawText(600, 484, "CONNECTION LOST", 8),
            0 == player.isDead &&
              playSound([
                3, 0, 1, 0, 0, 0.35173364, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                1, 0, 0, 0, 0, 0.25,
              ]),
            player.isDead++,
            50 == player.isDead && initLevels()),
          !player.inMove &&
            !player.G &&
            ((r || l || d || u) &&
              ((player.inMove = !0),
              (player.targetX = player.x),
              (player.targetZ = player.z)),
            r
              ? ((player.targetX = player.x + 1), (player.rotation = 0))
              : l
              ? ((player.targetX = player.x - 1), (player.rotation = Math.PI))
              : d
              ? ((player.targetZ = player.z + 1),
                (player.rotation = -Math.PI / 2))
              : u &&
                ((player.targetZ = player.z - 1),
                (player.rotation = Math.PI / 2)),
            r || l || d || u))
        ) {
          if (
            getLevel(player.targetX, player.targetZ, "level").level > player.y
          )
            (player.inMove = !1),
              (player.targetX = player.x),
              (player.targetZ = player.z);
          else {
            var y = getLevel(player.targetX, player.targetZ, "objects"),
              c = !0;
            if (
              (y.o &&
                ("gem" == y.o.type &&
                  (playSound([
                    1, 0, 0.048964577296413875, 0.48504748609295134, 0.583,
                    0.786, 0, 0, 0, 0, 0, 0.524, 0.555490134615729, 0, 0, 0, 0,
                    0, 1, 0, 0, 0, 0, 0.25,
                  ]),
                  (y.o.disabled = !0)),
                (c = "elec" != y.o.type)),
              c)
            )
              if (y.level > player.y + 1)
                (player.inMove = !1),
                  (player.targetX = player.x),
                  (player.targetZ = player.z);
              else if (y.level == player.y + 1) {
                getLevel(
                  player.x + 2 * (player.targetX - player.x),
                  player.z + 2 * (player.targetZ - player.z),
                  "all"
                ).level > player.y
                  ? ((player.inMove = !1),
                    (player.targetX = player.x),
                    (player.targetZ = player.z))
                  : (player.pushObj = y.o);
              } else
                y.level > player.y &&
                  ((player.inMove = !1),
                  (player.targetX = player.x),
                  (player.targetZ = player.z));
            else
              (player.inMove = !1),
                (player.targetX = player.x),
                (player.targetZ = player.z);
          }
          player.inMove &&
            playSound([
              0, 0, 0.24, 0, 0.179, 0.189, 0, 0.157, 0, 0, 0, 0, 0, 0.38, 0, 0,
              0, 0, 0.577, 0, 0, 0, 0, 0.2,
            ]);
        }
        for (var b = [], h = 0; h < robot.length; )
          b.push({
            x: robot[h][0],
            y:
              robot[h][1] +
              (h > (12 == levelEnCours ? -1 : 3)
                ? Math.abs(Math.sin(frame / 15)) *
                  (12 == levelEnCours ? (h > 3 ? 0.6 : 0.5) : 0.1)
                : 0),
            z: robot[h][2],
            h: robot[h][3],
            w: robot[h][4],
            d: robot[h][5],
            type: "player",
            rotation: {
              x: 0,
              y: player.rotation + (12 == levelEnCours ? frame / 8 : 0),
              z: 0,
            },
            part: ++h,
          });
        for (n = 0; n < levels[levelEnCours].height; n++)
          for (g = 0; g < levels[levelEnCours].width; g++)
            b.push({
              x: g,
              y: 0,
              z: n,
              h: levels[levelEnCours].tiles[n][g].h,
              type: "block",
              texture: levels[levelEnCours].tiles[n][g].texture,
              t: levels[levelEnCours].tiles[n][g].t,
            });
        for (obj of levels[levelEnCours].objects)
          obj.disabled ||
            ("gem" == obj.type && (obj.rotation.y = frame / 132), b.push(obj));
        var v = shaderShadow;
        for (obj of (gl.useProgram(v),
        gl.bindFramebuffer(gl.FRAMEBUFFER, shadow_frame_buffer),
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT),
        gl.viewport(
          0,
          0,
          shadow_frame_buffer.width,
          shadow_frame_buffer.height
        ),
        gl.uniform1f(v.it, frame),
        gl.uniform1i(v.level, levelEnCours),
        gl.uniform2f(
          v.levelSize,
          levels[levelEnCours].width,
          levels[levelEnCours].width
        ),
        b)) {
          var m = obj.h,
            x = obj.type,
            p = ((g = obj.x), obj.y);
          (n = obj.z), (m = obj.h);
          if ("elec" != x) {
            (mvMatrixShadow = getMatrix(light, obj)),
              gl.uniform3f(v.worldPosition, g, p, n);
            var E = getCube(obj.w || 0.5, m, obj.d || 0.5);
            copyGeometryInAttribute(
              v,
              x + "Shadow",
              (obj.w || 1) + "" + m + (obj.d || 1),
              E
            ),
              gl.uniformMatrix4fv(v.pMatrixUniform, !1, pMatrix),
              gl.uniformMatrix4fv(v.mvMatrixUniform, !1, mvMatrixShadow);
            var T = 0;
            gl.uniform1i(v.objectType, T),
              obj.t &&
                ((obj.t.triggered && 7 != obj.t.color) ||
                  gl.uniform1i(v.objectType, obj.t.color)),
              gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, cubeVertexIndexBuffer),
              gl.drawElements(gl.TRIANGLES, 36, gl.UNSIGNED_SHORT, 0);
          }
        }
        gl.bindFramebuffer(gl.FRAMEBUFFER, null),
          gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
        v = shaderCamera;
        for (obj of (gl.useProgram(v),
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT),
        gl.uniform3f(v.ambientColor, 0.1, 0.1, 0.1),
        gl.uniform1f(v.it, frame),
        gl.uniform2f(v.resolution, canvas.width, canvas.height),
        gl.uniform1i(v.level, levelEnCours),
        gl.uniform2f(
          v.levelSize,
          levels[levelEnCours].width,
          levels[levelEnCours].width
        ),
        b)) {
          (g = obj.x), (p = obj.y), (n = obj.z), (m = obj.h), (x = obj.type);
          var w = JSON.parse(JSON.stringify(camera));
          (w.x = camera.x + cameraX),
            (w.y = camera.y + cameraY),
            (w.z = camera.z + cameraZ),
            (w.rotation.x = camera.rotation.x + cameraRotationX),
            (w.rotation.y = camera.rotation.y + cameraRotationY),
            (w.rotation.z = camera.rotation.z + cameraRotationZ),
            (mvMatrix = getMatrix(w, obj)),
            (mvMatrixShadow = getMatrix(light, obj)),
            copyUVWInAttribute(v, x, obj.w || 0.5, m, obj.d || 0.5);
          E = getCube(obj.w || 0.5, m, obj.d || 0.5);
          copyGeometryInAttribute(
            v,
            x,
            (obj.w || 1) + "" + m + (obj.d || 1),
            E
          ),
            copyNormalDone ||
              (copyNormalsInAttribute(v), (copyNormalDone = !0)),
            gl.uniform3f(v.worldPosition, g, m, n),
            gl.uniform1i(v.isPlayer, "player" == x ? obj.part : 0),
            gl.uniform1i(v.isGround, "block" == x || "wall" == x ? 1 : 0),
            player.isDead && gl.uniform1i(v.isPlayer, 20 + player.isDead),
            gl.uniform3fv(v.endPosition, levels[levelEnCours].end);
          T = 0;
          switch (x) {
            case "gem":
              T = 1;
              break;
            case "elec":
              T = 2;
              break;
            case "crate":
              T = 5;
              break;
            case "wall2":
              T = 6;
              break;
            default:
              T = 0;
          }
          gl.uniform1i(v.objectType, T),
            obj.t &&
              ((obj.t.triggered && 7 != obj.t.color) ||
                gl.uniform1i(v.objectType, obj.t.disabled ? 5 : obj.t.color)),
            "gem" == x ||
            "elec" == x ||
            (obj.t && (3 == obj.t.color || 4 == obj.t.color))
              ? (gl.enable(gl.BLEND),
                gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA))
              : gl.disable(gl.BLEND),
            gl.uniformMatrix4fv(v.pMatrixUniform, !1, pMatrix),
            gl.uniformMatrix4fv(v.mvMatrixUniform, !1, mvMatrix),
            gl.uniformMatrix4fv(v.u_Shadowmap_transform, !1, mvMatrixShadow);
          var R = mat4.create();
          mat4.invert(R, mvMatrix),
            mat4.transpose(R, R),
            gl.uniformMatrix4fv(v.nMatrixUniform, !1, R),
            gl.uniform1i(v.textureID, 1),
            gl.activeTexture(gl.TEXTURE1),
            gl.bindTexture(gl.TEXTURE_2D, obj.texture),
            gl.uniform1i(v.depthTextureID, 0),
            gl.activeTexture(gl.TEXTURE0),
            gl.bindTexture(gl.TEXTURE_2D, shadow_frame_buffer.color_buffer),
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, cubeVertexIndexBuffer),
            gl.drawElements(gl.TRIANGLES, 36, gl.UNSIGNED_SHORT, 0);
        }
      }
      function resize() {
        (canvas.width = canvasHUD.width = gl.viewportWidth = window.innerWidth),
          (canvas.height =
            canvasHUD.height =
            gl.viewportHeight =
              window.innerWidth / window.innerHeight < 1.77
                ? window.innerWidth / 1.77
                : window.innerHeight),
          gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight),
          mat4.perspective(
            45,
            gl.viewportWidth / gl.viewportHeight,
            0.1,
            100,
            pMatrix
          ),
          mat4.identity(mvMatrix),
          initShadows();
      }
      function initShadows() {
        var e = gl.viewportWidth,
          t = gl.viewportHeight;
        if (gl.getExtension("WEBGL_depth_texture")) {
          shadow_frame_buffer = gl.createFramebuffer();
          var r = gl.createTexture();
          gl.bindTexture(gl.TEXTURE_2D, r),
            gl.texImage2D(
              gl.TEXTURE_2D,
              0,
              gl.RGBA,
              e,
              t,
              0,
              gl.RGBA,
              gl.UNSIGNED_BYTE,
              null
            ),
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR),
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR),
            gl.texParameteri(
              gl.TEXTURE_2D,
              gl.TEXTURE_WRAP_S,
              gl.CLAMP_TO_EDGE
            ),
            gl.texParameteri(
              gl.TEXTURE_2D,
              gl.TEXTURE_WRAP_T,
              gl.CLAMP_TO_EDGE
            );
          var a = gl.createTexture();
          gl.bindTexture(gl.TEXTURE_2D, a),
            gl.texImage2D(
              gl.TEXTURE_2D,
              0,
              gl.DEPTH_COMPONENT,
              e,
              t,
              0,
              gl.DEPTH_COMPONENT,
              gl.UNSIGNED_INT,
              null
            ),
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR),
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR),
            gl.texParameteri(
              gl.TEXTURE_2D,
              gl.TEXTURE_WRAP_S,
              gl.CLAMP_TO_EDGE
            ),
            gl.texParameteri(
              gl.TEXTURE_2D,
              gl.TEXTURE_WRAP_T,
              gl.CLAMP_TO_EDGE
            ),
            gl.bindFramebuffer(gl.FRAMEBUFFER, shadow_frame_buffer),
            gl.framebufferTexture2D(
              gl.FRAMEBUFFER,
              gl.COLOR_ATTACHMENT0,
              gl.TEXTURE_2D,
              r,
              0
            ),
            gl.framebufferTexture2D(
              gl.FRAMEBUFFER,
              gl.DEPTH_ATTACHMENT,
              gl.TEXTURE_2D,
              a,
              0
            ),
            (shadow_frame_buffer.color_buffer = r),
            (shadow_frame_buffer.depth_buffer = a),
            (shadow_frame_buffer.width = e),
            (shadow_frame_buffer.height = t),
            gl.bindTexture(gl.TEXTURE_2D, null),
            gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        } else
          alert(
            "The extension WEBGL_depth_texture is not supported by your browser."
          );
      }
      function init() {
        (canvasHUD = document.getElementById("HUD")),
          (ctx = canvasHUD.getContext("2d")),
          (canvas = document.getElementById("game")),
          (gl = canvas.getContext("webgl"));
        var e = document.createElement("canvas");
        e.width = e.height = 512;
        var t = e.getContext("2d"),
          r = t.getImageData(0, 0, e.width, e.height),
          a = t.getImageData(0, 0, e.width, e.height);
        t.clearRect(0, 0, e.width, e.height);
        for (var l = 0, o = 0, i = 0; i < r.data.length; i += 4) {
          512 == ++l && (l = 0),
            (o = Math.floor(i / 4 / 512)),
            (s = l / 512),
            (o /= 512);
          var n = 275 * Math.random();
          (a.data[i] = 0.93 * n),
            (a.data[i + 1] = 0.9098 * n),
            (a.data[i + 2] = 0.6666 * n),
            (a.data[i + 3] = 255),
            (Math.abs(0.5 - s) > 0.49 || Math.abs(0.5 - o) > 0.49) &&
              (n *= 0.8),
            ((s > 0.49 && s < 0.51) || (o > 0.49 && o < 0.51)) && (n *= 0.8),
            (r.data[i] = 0.93 * n),
            (r.data[i + 1] = 0.9098 * n),
            (r.data[i + 2] = 0.6666 * n),
            (r.data[i + 3] = 255);
        }
        t.putImageData(r, 0, 0),
          img2texture("noise", e),
          t.putImageData(a, 0, 0),
          img2texture("noise2", e);
        for (l = 0, o = 0, i = 0; i < r.data.length; i += 4) {
          512 == ++l && (l = 0),
            (o = Math.floor(i / 4 / 512)),
            (s = l / 512),
            (o /= 512);
          n = Math.hypot(0.08 - s, 0.08 - o);
          (n = Math.min(n, Math.hypot(0.92 - s, 0.08 - o))),
            (n = Math.min(n, Math.hypot(0.92 - s, 0.92 - o))),
            (n = Math.min(n, Math.hypot(0.08 - s, 0.92 - o))),
            (B = s > 0.075 && s < 0.925),
            (D = s < 0.925 && s > 0.915),
            (C = s > 0.075 && s < 0.085),
            (G = Math.abs(0.5 - o) > 0.415 && Math.abs(0.5 - o) < 0.425),
            (A = Math.abs(0.5 - o) < 0.425),
            (n =
              n < 0.01
                ? 240
                : n < 0.02
                ? 200
                : A && C
                ? 50
                : A && D
                ? 50
                : B && G
                ? 50
                : 127),
            (Math.abs(0.5 - s) > 0.49 || Math.abs(0.5 - o) > 0.49) &&
              (n *= 0.8),
            (r.data[i] = n),
            (r.data[i + 1] = n),
            (r.data[i + 2] = 1.1 * n),
            (r.data[i + 3] = 255);
        }
        t.putImageData(r, 0, 0),
          img2texture("mur", e),
          (ctx.canvas.width = ctx.canvas.height = 512),
          ctx.fillRect(0, 0, 512, 512),
          (gameStarted = !0),
          drawText(900, 2400, "EXIT", 60),
          (gameStarted = !1);
        var g = document.createElement("CANVAS");
        (g.width = 256),
          (g.height = 256),
          g
            .getContext("2d")
            .drawImage(ctx.canvas, 0, 0, 512, 512, 0, 0, 256, 256),
          img2texture("exit", g),
          t.clearRect(0, 0, e.width, e.height);
        r = t.getImageData(0, 0, e.width, e.height);
        for (var s = 0; s < 512; s++)
          for (o = 0; o < 512; o++) {
            (i = 4 * s + 2048 * o), (n = Math.floor(200 * Math.random()));
            (dX = s / 256 - 1), (dY = o / 256 - 1);
            var f = 1;
            (Math.abs(dX) > 0.8 || Math.abs(dY) > 0.8) && (f = 0.3),
              Math.abs(Math.abs(dX) - Math.abs(dY)) < 0.15 && (f = 0.3),
              Math.abs(dX) > 0.5 && Math.abs(dX) < 0.6 && (f = 0.3),
              Math.abs(dY) > 0.5 && Math.abs(dY) < 0.6 && (f = 0.3),
              Math.abs(dX) > 0.9 && Math.abs(dY) > 0.9 && (f = 0.8),
              (n *= f),
              (r.data[i] = n),
              (r.data[i + 1] = n),
              (r.data[i + 2] = 0.89 * n),
              (r.data[i + 3] = 255);
          }
        t.putImageData(r, 0, 0),
          img2texture("crate", e),
          (camera = { rotation: { x: 0.56, y: -0.87, z: 0.03 } }),
          resize(),
          gl.clearColor(0.5, 0.25, 0.85, 1),
          gl.clearColor(0.93, 0.9098, 0.6666, 1),
          gl.enable(gl.DEPTH_TEST),
          initShaders(),
          initShadows(),
          initLevels(),
          render();
      }
      function initLevels() {
        for (var e of (levels = [
          {
            start: { x: 2, z: 3 },
            end: [10, 3, 3],
            camera: [3.8, 3.4, 3.4],
            texture: noise,
            data: [
              "333333333333",
              "112222333333",
              "112222333333",
              "112222222223",
              "112222333333",
              "112222333333",
              "333333333333",
            ],
            gems: [],
            crates: [[5, 2.5, 3]],
            elevator: [],
            objects: [],
            triggers: [],
          },
          {
            start: { x: 2, z: 3 },
            end: [10, 4.5, 3],
            camera: [6, 9, 5.5],
            texture: noise,
            data: [
              "333333333333",
              "112222333333",
              "112222333333",
              "112222222223",
              "112222333333",
              "112222333333",
              "333333333333",
            ],
            gems: [[4, 2, 1]],
            crates: [[5, 2.5, 3]],
            elevator: [],
            objects: [],
            triggers: [],
          },
          {
            start: { x: 2, z: 4 },
            end: [10, 4.5, 2],
            camera: [5.2, 11.7, 7.5],
            texture: noise,
            data: [
              "333333333333",
              "322232323333",
              "322222222323",
              "322222223333",
              "322222223333",
              "322222223333",
              "322222222333",
              "322232323333",
              "333333333333",
            ],
            gems: [
              [1, 2, 1],
              [7, 2, 7],
            ],
            crates: [
              [5, 2.5, 3],
              [5, 2.5, 5],
              [7, 2.5, 3],
              [7, 2.5, 5],
            ],
            elevator: [],
            objects: [],
            triggers: [
              {
                x: 5,
                z: 7,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 10,
                bZ: 3,
                bH: -1,
              },
              {
                x: 5,
                z: 1,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 10,
                bZ: 4,
                bH: -1,
              },
              {
                x: 8,
                z: 2,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 8,
                bZ: 4,
                bH: -1,
              },
              {
                x: 8,
                z: 6,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 9,
                bZ: 4,
                bH: -1,
              },
            ],
          },
          {
            start: { x: 2, z: 5 },
            end: [13, 4.5, 5],
            camera: [6.4, 13.5, 8.3],
            texture: noise,
            data: [
              "666666666666666",
              "611111111111226",
              "611111111111226",
              "655555551112223",
              "655554321112223",
              "655554321122223",
              "655554321112223",
              "655555551112223",
              "611111111111223",
              "611111111111223",
              "655443333333333",
            ],
            gems: [
              [7, 2, 4],
              [11, 2, 7],
            ],
            crates: [
              [2, 5.5, 3],
              [2, 5.5, 7],
            ],
            objects: [],
            elevator: [],
            triggers: [
              {
                x: 7,
                z: 3,
                y: 5,
                color: 4,
                triggered: !1,
                bX: 8,
                bZ: 5,
                bH: 1,
              },
              {
                x: 7,
                y: 5,
                z: 7,
                color: 4,
                triggered: !1,
                bX: 9,
                bZ: 5,
                bH: 1,
              },
            ],
          },
          {
            start: { x: 1, z: 6 },
            end: [14, 4.5, 2],
            camera: [7.5, 12.8, 6.9],
            texture: noise,
            data: [
              "5555555555555555",
              "5334445111111255",
              "5434445444432222",
              "5334442111111233",
              "5322222111111233",
              "5333332111111233",
              "5222222111111233",
              "5333333333333333",
            ],
            gems: [
              [2, 2, 4],
              [13, 2, 1],
              [1, 3, 1],
            ],
            crates: [[4, 4.5, 2]],
            elevator: [
              [5, 4, 3],
              [2, 2, 4],
            ],
            objects: [],
            triggers: [
              {
                x: 1,
                z: 2,
                y: 4,
                color: 4,
                triggered: !1,
                bX: 6,
                bZ: 2,
                bH: -1,
              },
            ],
          },
          {
            start: { x: 2, z: 3 },
            end: [15, 4.5, 5],
            camera: [7.3, 14.2, 9.7],
            texture: noise,
            data: [
              "4444444443333333",
              "4332333331111123",
              "4322111111111123",
              "4322222111112223",
              "4322112221222123",
              "4222111121211122",
              "4322112221222123",
              "4422222211112223",
              "4422111111111123",
              "4422222111111123",
              "4433333333333334",
            ],
            gems: [
              [1, 3, 1],
              [1, 3, 6],
              [6, 2, 9],
            ],
            crates: [
              [3, 2.5, 4],
              [3, 2.5, 6],
              [12, 2.5, 4],
              [12, 2.5, 6],
            ],
            elevator: [
              [3, 1, 3],
              [1, 5, 3],
            ],
            objects: [],
            triggers: [
              {
                x: 6,
                z: 1,
                y: 3,
                color: 4,
                triggered: !1,
                bX: 6,
                bZ: 8,
                bH: 1,
              },
              {
                x: 6,
                z: 6,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 9,
                bZ: 5,
                bH: 1,
              },
            ],
          },
          {
            start: { x: 2, z: 6 },
            end: [14, 4.5, 8],
            camera: [7.9, 12.8, 8.6],
            texture: noise,
            data: [
              "4444443333333333",
              "4333311111112223",
              "4223312221222223",
              "4322242121112323",
              "4323331122112223",
              "4222222222222223",
              "3222321122222113",
              "3222221111111113",
              "3232221222222223",
              "3333333333333333",
            ],
            gems: [
              [11, 2, 2],
              [10, 2, 8],
              [12, 2, 8],
            ],
            crates: [
              [2, 2.5, 3],
              [3, 3.5, 2],
              [13, 2.5, 4],
            ],
            elevator: [
              [1, 5, 3],
              [6, 3, 3],
            ],
            objects: [],
            triggers: [
              {
                x: 4,
                z: 3,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 5,
                bZ: 3,
                bH: -1,
              },
              {
                x: 3,
                z: 6,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 1,
                bZ: 2,
                bH: 1,
              },
              {
                x: 10,
                z: 2,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 6,
                bZ: 8,
                bH: 1,
              },
              {
                x: 6,
                z: 5,
                y: 2,
                color: 7,
                triggered: !0,
                bX: 6,
                bZ: 5,
                bH: 1,
              },
            ],
          },
          {
            start: { x: 3, z: 5 },
            end: [16, 6.5, 5],
            camera: [8.9, 13.8, 9.3],
            texture: noise,
            data: [
              "66666666666666666",
              "51111111111112345",
              "52222222211112345",
              "52333332222112345",
              "52344432212112345",
              "52344432111112344",
              "52344432212112345",
              "52333332222112345",
              "52222222211112345",
              "51111111111112345",
              "62222222222223455",
            ],
            gems: [
              [13, 2, 4],
              [14, 3, 4],
              [15, 4, 4],
              [13, 2, 6],
              [14, 3, 6],
              [15, 4, 6],
            ],
            crates: [
              [5, 4.5, 4],
              [5, 4.5, 5],
              [5, 4.5, 6],
            ],
            elevator: [
              [13, 5, 3],
              [14, 5, 4],
              [15, 5, 5],
            ],
            objects: [],
            triggers: [
              {
                x: 1,
                z: 8,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 10,
                bZ: 5,
                bH: 1,
              },
              {
                x: 8,
                z: 2,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 11,
                bZ: 5,
                bH: 1,
              },
              {
                x: 1,
                z: 3,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 12,
                bZ: 5,
                bH: 1,
              },
            ],
          },
          {
            start: { x: 2, z: 2 },
            end: [12, 3.5, 1],
            camera: [7, 10.9, 7.4],
            texture: noise2,
            data: [
              "3333333333333",
              "3332122221222",
              "3322111111111",
              "3322111112221",
              "3322222222321",
              "3322111122221",
              "3333111123211",
              "3111111122211",
              "3111111111111",
            ],
            gems: [
              [6, 2, 1],
              [9, 2, 1],
            ],
            crates: [
              [3, 2.5, 4],
              [3, 2.5, 3],
            ],
            elevator: [],
            objects: [],
            triggers: [
              {
                x: 2,
                z: 4,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 4,
                bZ: 1,
                bH: 1,
              },
              {
                x: 2,
                z: 3,
                y: 2,
                color: 4,
                triggered: !1,
                bX: 9,
                bZ: 1,
                bH: 1,
              },
            ],
          },
          {
            start: { x: 1, z: 6 },
            end: [10, 3.5, 8],
            camera: [5, 11.9, 8.3],
            texture: noise2,
            data: [
              "33333333333",
              "11111222223",
              "11112222213",
              "31111112211",
              "32222222311",
              "32222222211",
              "32221122211",
              "32221111111",
              "32211111112",
              "33331111111",
            ],
            gems: [
              [6, 2, 6],
              [3, 2, 4],
              [4, 2, 2],
            ],
            crates: [
              [2, 2.5, 4],
              [3, 2.5, 5],
              [4, 2.5, 4],
              [6, 2.5, 4],
              [7, 2.5, 4],
            ],
            elevator: [],
            objects: [],
            triggers: [
              {
                x: 1,
                y: 2,
                z: 8,
                color: 4,
                triggered: !1,
                bX: 9,
                bZ: 8,
                bH: 1,
              },
              {
                x: 3,
                y: 2,
                z: 7,
                color: 4,
                triggered: !1,
                bX: 8,
                bZ: 8,
                bH: 1,
              },
              {
                x: 3,
                y: 2,
                z: 6,
                color: 4,
                triggered: !1,
                bX: 7,
                bZ: 8,
                bH: 1,
              },
              {
                x: 5,
                y: 2,
                z: 1,
                color: 4,
                triggered: !1,
                bX: 6,
                bZ: 8,
                bH: 1,
              },
              {
                x: 9,
                y: 2,
                z: 1,
                color: 4,
                triggered: !1,
                bX: 6,
                bZ: 7,
                bH: 1,
              },
            ],
          },
          {
            start: { x: 2, z: 4 },
            end: [9, 5.5, 4],
            camera: [4.6, 12, 7.5],
            texture: mur,
            data: [
              "555555555555",
              "534333332555",
              "533333342555",
              "534333332345",
              "534443432335",
              "534333332345",
              "534333332555",
              "534344332555",
              "555555555555",
            ],
            gems: [
              [2, 4, 1],
              [2, 4, 7],
            ],
            crates: [
              [4, 3.5, 2],
              [6, 3.5, 6],
              [2, 4.5, 5],
            ],
            objects: [],
            elevator: [
              [4, 3, 4],
              [3, 7, 4],
            ],
            triggers: [
              {
                x: 6,
                y: 3,
                z: 5,
                color: 4,
                triggered: !1,
                bX: 5,
                bZ: 4,
                bH: 1,
              },
              {
                x: 1,
                y: 3,
                z: 7,
                color: 4,
                triggered: !1,
                bX: 5,
                bZ: 4,
                bH: 1,
              },
            ],
          },
          {
            start: { x: 1, z: 2 },
            end: [12, 4.5, 10],
            camera: [8.4, 15.9, 10.4],
            texture: mur,
            data: [
              "44445555555555555",
              "43333354544443435",
              "43334344545443235",
              "43333344444443225",
              "42223345555553224",
              "42323234222253224",
              "42322222233253224",
              "42333234333253224",
              "43333223222222224",
              "42223223333333224",
              "42222222222223444",
              "43333333333333444",
            ],
            gems: [
              [11, 4, 1],
              [6, 3, 5],
              [14, 2, 9],
              [9, 2, 10],
              [10, 2, 10],
            ],
            crates: [
              [12, 2.5, 8],
              [6, 4.5, 2],
              [4, 4.5, 2],
            ],
            elevator: [
              [14, 2, 3],
              [15, 3, 3],
              [15, 1, 4],
              [13, 1, 4],
              [5, 3, 4],
              [1, 4, 3],
              [4, 3, 4],
            ],
            objects: [
              {
                x: 4,
                y: 2.5,
                z: 10,
                h: 0,
                w: 0.5,
                d: 0.5,
                type: "elec",
                G: 0,
                rotation: { x: 0, y: Math.PI / 2, z: 0 },
              },
              {
                x: 7,
                y: 2.5,
                z: 10,
                h: 0,
                w: 0.5,
                d: 0.5,
                type: "elec",
                G: 0,
                rotation: { x: 0, y: Math.PI / 2, z: 0 },
              },
            ],
            triggers: [
              {
                x: 3,
                y: 3,
                z: 2,
                color: 4,
                triggered: !1,
                objID: 0,
                type: "disable",
              },
              {
                x: 2,
                y: 2,
                z: 10,
                color: 4,
                triggered: !1,
                objID: 1,
                type: "disable",
              },
              {
                x: 9,
                y: 4,
                z: 1,
                color: 4,
                triggered: !1,
                bX: 6,
                bZ: 4,
                bH: -1,
              },
            ],
          },
          {
            start: { x: 2, z: 3 },
            end: [10, 3, 3],
            camera: [3.8, 3.4, 3.4],
            texture: noise,
            data: [
              "333333333333",
              "112222333333",
              "112222333333",
              "112222222223",
              "112222333333",
              "112222333333",
              "333333333333",
            ],
            gems: [],
            crates: [[5, 2.5, 3]],
            elevator: [],
            objects: [],
            triggers: [],
          },
        ])) {
          (e.height = e.data.length),
            (e.width = e.data[0].length),
            (e.tiles = new Array(e.height)
              .fill(null)
              .map(() => new Array(e.width).fill(null)));
          for (var t = 0; t < e.height; t++)
            for (var r = 0; r < e.width; r++) {
              var a = e.data[t][r] - 0;
              e.tiles[t][r] = { h: a, t: null, texture: e.texture };
            }
          for (var l of (e.objects.push(
            {
              x: -3.5,
              y: 0,
              z: 4.5,
              h: 3,
              d: 7,
              w: 3,
              type: "wall",
              texture: e.texture,
            },
            {
              x: e.width + 2.5,
              y: 0,
              z: 4.5,
              h: 3,
              d: 7,
              w: 3,
              type: "wall",
              texture: e.texture,
            }
          ),
          e.objects.push({
            x: e.end[0] + 0.05,
            y: e.end[1] - 3.5,
            z: e.end[2] + 0.05,
            h: 2.5,
            d: 0.025,
            w: 0.025,
            type: "wall2",
            texture: exit,
          }),
          e.objects.push({
            x: e.end[0] + 0.05,
            y: e.end[1] - 0.75,
            z: e.end[2] + 0.05,
            h: 0.25,
            d: 0.5,
            w: 0.025,
            type: "wall2",
            texture: exit,
            rotation: { x: 0, y: 0.1, z: 0 },
          }),
          e.gems))
            e.objects.push({
              x: l[0],
              y: l[1] + 0.5,
              z: l[2],
              h: 0.15,
              w: 0.15,
              d: 0.15,
              type: "gem",
              rotation: { x: 0, y: 0, z: 0 },
            });
          for (var l of e.crates)
            e.objects.push({
              x: l[0],
              y: l[1],
              z: l[2],
              h: 0.5,
              type: "crate",
              texture: crate,
            });
          for (var l of e.elevator)
            e.triggers.push({
              x: l[0],
              y: l[2],
              z: l[1],
              color: 3,
              triggered: !1,
              bX: l[0],
              bZ: l[1],
              bH: 1,
            });
          for (var o of e.triggers)
            (o.trigger = function (e) {
              if (
                this.triggered != e &&
                ((this.triggered = e), !e || 7 != this.color)
              )
                switch (
                  (e || 7 != this.color || (this.disabled = !0),
                  e
                    ? playSound([
                        1, 0, 0.04237237148676246, 0, 0.19584240715207285,
                        0.498, 0, 0.222, 0.248, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,
                        0, 0.9712656456828678, 0, 0.25,
                      ])
                    : playSound([
                        1, 0, 0.04237237148676246, 0, 0.19584240715207285,
                        0.498, 0, -0.222, 0.248, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1,
                        0, 0, 0.9712656456828678, 0, 0.25,
                      ]),
                  this.type)
                ) {
                  case "disable":
                    levels[levelEnCours].objects[this.objID].disabled =
                      this.triggered;
                    break;
                  default:
                    levels[levelEnCours].tiles[this.bZ][this.bX].targetH =
                      levels[levelEnCours].tiles[this.bZ][this.bX].h +
                      (this.triggered ? this.bH : -this.bH);
                }
            }),
              (e.tiles[o.z][o.x].t = o);
        }
        (player = {
          x: levels[levelEnCours].start.x,
          y: 8,
          z: levels[levelEnCours].start.z,
          inMove: !1,
          targetX: 0,
          targetZ: 0,
          rotation: 0,
          G: 0,
          isDead: 0,
        }),
          (camera.x = levels[levelEnCours].camera[0]),
          (camera.y = levels[levelEnCours].camera[1]),
          (camera.z = levels[levelEnCours].camera[2]),
          11 == levelEnCours
            ? (light = {
                x: 15,
                y: 17,
                z: 13,
                rotation: { x: 1, y: -0.5, z: 0 },
              })
            : 12 == levelEnCours &&
              (camera.rotation = { x: 0.56, y: -0.87, z: 0.03 });
      }
      (t = m = u = r = d = l = 0),
        (onkeydown = onkeyup =
          (e) => {
            (this[
              "lurd************************l**r********m***ltd***u**u"[
                e.which - 37
              ]
            ] = !!e.type[5]),
              77 == e.which && m
                ? (sound = !sound)
                : 82 == e.which && t && initLevels(),
              !gameStarted &&
                (levelEnCours++,
                initLevels(),
                (gameStarted = !0),
                (camera.rotation = { x: 1.23, y: 0, z: 0 }));
          });
    </script>
    <style type="text/css">
      body {
        margin: 0;
      }
      #HUD {
        position: absolute;
        top: 0;
        left: 0;
      }
    </style>
    <script id="fragmentShaderCamera" type="x-shader/x-fragment">
      precision mediump int;precision highp float;uniform sampler2D textureID;uniform sampler2D depthTextureID;uniform vec3 endPosition;uniform float it;uniform int isPlayer;uniform int objectType;uniform int isGround;uniform int level;uniform vec2 resolution;varying vec2 uv;varying highp vec3 vLighting;varying vec4 v_Vertex_relative_to_light;varying vec3 localPosition;varying vec3 worldPositionOK;varying vec3 normal;vec3 random3(vec3 c) {float j = 4096.*sin(dot(c,vec3(17., 59.4, 15.)));vec3 r;r.z = fract(512.*j);j *= .125;r.x = fract(512.*j);j *= .125;r.y = fract(512.*j);return r-.5;}float simplex3d(vec3 p) { vec3 s = floor(p + dot(p, vec3(.3333333))); vec3 x = p - s + dot(s, vec3(.1666667)); vec3 e = step(vec3(0.), x - x.yzx); vec3 i1 = e*(1. - e.zxy); vec3 i2 = 1. - e.zxy*(1. - e); vec3 x1 = x - i1 + .16; vec3 x2 = x - i2 + 2.*.16; vec3 x3 = x - 1. + 3.*.16; vec4 w, d; w.x = dot(x, x); w.y = dot(x1, x1); w.z = dot(x2, x2); w.w = dot(x3, x3); w = max(.6 - w, 0.); d.x = dot(random3(s), x); d.y = dot(random3(s + i1), x1); d.z = dot(random3(s + i2), x2); d.w = dot(random3(s + 1.), x3); w *= w; w *= w; d *= w; return dot(d, vec4(52.));}mat2 makem2(float theta){float c = cos(theta);float s = sin(theta);return mat2(c,-s,s,c);}float noise2(vec2 x){ return texture2D(textureID, x*.01).x;}float flow(vec2 p) {float z=2.;float rz = 0.;float speed = it/512.;for (float i= 1.;i < 7.;i++ ) {p += speed*.6;rz+= (sin(noise2(p)*7.)*.5+.5)/z;z *= 1.4;p *= 2.;}return rz;}float noiseTV(vec2 pos, float evolve) {    float e = fract(evolve*.01);    float cx  = pos.x*e;    float cy  = pos.y*e;    return fract(23. * fract(2. / fract(fract(cx*2.4 / cy*23. + pow(abs(cy/22.4),2.)))));}float _texture(vec3 p, float size) {p=abs(.5-fract(p*size));vec3 c=vec3(3.);float es, l=es=0.;for (int i = 0; i < 8; i++) { p = abs(p + c) - abs(p - c) - p; p/= clamp(dot(p, p), .0, 1.);p = p* -2.5 + c;if ( mod(float(i), 2.) < 1. ) { float pl = l;l = length(p);es+= exp(-1. / abs(l - pl));}}return es;}float random(in vec2 p) { return fract(sin(dot(p.xy, vec2(12.9898,58.233))) * 43758.5453123); }float noise (in vec2 p) {vec2 i = floor(p);vec2 f = fract(p);float a = random(i);float b = random(i + vec2(1., 0.));float c = random(i + vec2(0., 1.));float d = random(i + vec2(1., 1.));vec2 u = f * f * (3. - 2. * f);return mix(a, b, u.x) + (c - a)* u.y * (1. - u.x) + (d - b) * u.x * u.y;}float fbm(in vec2 p) {float value = 0.;float amplitude = 1.;for (int i = 0; i < 6; i++) {value += amplitude * noise(p);p *= 3.;amplitude *= .5;}return value;}vec4 mainNoise(vec2 uv) {return vec4( fbm(uv + (fbm(uv) * 5.) ) );}void main() {if (isPlayer>=20) { vec3 colour = vec3(noiseTV(gl_FragCoord.xy,it));gl_FragColor = vec4(colour, 1.);return;}if (objectType==2) { vec2 uv2 = uv * 2. -1.;  if (abs(1.-uv2.x)<.10 && abs(uv2.y)<.2) { gl_FragColor = vec4(1.);} else {vec3 col = vec3(1.4, 1.4, 1.8);col = col * -pow(abs((.5*simplex3d(vec3(vec3(worldPositionOK.xz / 2., it*.007)*12.))) * -(clamp((uv2.x * -uv2.x * .16) + .55, 0., 1.)) + uv2.y), .4) + col;                    col*= col;col*= col;gl_FragColor = vec4(col, col);}} else if (isGround==1 && worldPositionOK.y<2.1) { if (level<=1) { gl_FragColor = vec4((vLighting * vec3(.25, .25, .8)) - _texture(worldPositionOK+(it/200.), .41)/40., .7);} else { vec2 p = worldPositionOK.xz;vec3 col = vec3(.2,.07,.01)/flow(p);col = pow(col,vec3(1.4)) * 4.;gl_FragColor= vec4(col * vLighting * (gl_FragCoord.w * 10.), 1.);}if (level==8 || level==9) {gl_FragColor = vec4((vLighting * vec3(.62, .38, .0)) * 0.5 - _texture(worldPositionOK+(it/200.), .01)/40., .7);gl_FragColor.b=0.0;gl_FragColor.a=1.0;return;}} else if (objectType==1) { gl_FragColor = vec4(localPosition.xzy*4.*vLighting*(gl_FragCoord.w*10.),.5);return;} else if (isPlayer>0) { gl_FragColor.a = 1.;if (isPlayer>0 && isPlayer<5) {gl_FragColor.rgb = vec3(.4, .22, .19);} else if (isPlayer>=5 && isPlayer<=8) {gl_FragColor.rgb = vec3(.25, .25, .45);} else if (isPlayer>8) {gl_FragColor.rgb = vec3(1.);}if (isPlayer==9) { if (localPosition.x>=.24) {float eyeHeight = .05;if (mod(it, 200.)<10.) {eyeHeight=.01;}if (abs(localPosition.z) > .05 && abs(localPosition.z) < .15 && abs(.075 - localPosition.y) <= eyeHeight) {gl_FragColor.rgb = vec3(0.);}if (abs(localPosition.z) > .075 && abs(localPosition.z) < .10 && abs(.065 - localPosition.y) <= eyeHeight/2.0) {gl_FragColor.rgb = vec3(1.);}}}gl_FragColor.rgb *= 1.8;} else { vec4 tc = texture2D(textureID, vec2(uv.x,uv.y));gl_FragColor = vec4(tc.rgb, tc.a);float n = noiseTV(uv.xy, 1.); gl_FragColor.rgb+= vec3(n*.1);if (objectType==4) { float l = length(uv * 2. -1.);float qty = .5 + sin(it/60.)*.15;if (l>qty && l<qty+.1) {if (level==8 || level==9) {gl_FragColor.rgb += vec3(1., 0., l*.5) * (2. - qty);} else {gl_FragColor.rgb += vec3(1., 0., l*.5) * (1. - qty);}}} else if (objectType==3) { float l = length(uv * 2. -1.);for (float i=0.; i<120.; i+=120./5.) {float qty = mod((it+i)/120., 1.) / 1.;if (l>qty && l<qty+.1) {gl_FragColor.rgb += vec3(l*.5, .0, 1.) * (1. - qty);}}}if (level<2) {float k = _texture(worldPositionOK, .05); gl_FragColor += k/20.;}if (level==8 || level==9) {vec2 pG =  worldPositionOK.xy;if (normal.y>0.) {pG = worldPositionOK.xz;} else if (abs(normal.x)>0.) {pG = worldPositionOK.yz;}float f = .6 * mainNoise( 1.*pG).r; f += .25 * mainNoise( 4.*pG).r;f = .8*f; if (normal.y>0.) {gl_FragColor *= vec4(vec3(f, f*1.6, f*.8), 1.);} else {gl_FragColor *= vec4(vec3(f, f*1., f*.8), 1.);}}if (objectType==5) {gl_FragColor.rgb*= 1.3;}}vec3 vertex_relative_to_light = v_Vertex_relative_to_light.xyz / v_Vertex_relative_to_light.w;vertex_relative_to_light = vertex_relative_to_light * .5 + .5;vec4 shadowmap_color = texture2D(depthTextureID, vertex_relative_to_light.xy);float shadowmap_distance = shadowmap_color.r * 2.;gl_FragColor.rgb *= shadowmap_distance * vLighting;gl_FragColor.rgb *= vec3(mix(.2, 1., localPosition.y/6.));if (normal.y>0.) {gl_FragColor.rgb*=.8;}return;}
    </script>
    <script id="vertexShaderCamera" type="x-shader/x-vertex">
      precision mediump int;precision highp float;attribute vec3 vertexPosition;attribute vec2 aTextureCoord;attribute vec3 aVertexNormal;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;uniform mat4 uNormalMatrix;uniform vec3 worldPosition;uniform mat4 u_Shadowmap_transform;uniform int objectType;uniform int isGround;uniform int level;uniform float it;uniform vec2 levelSize;varying vec2 uv;varying vec3 localPosition;varying highp vec3 vLighting;varying vec4 v_Vertex_relative_to_light;varying vec3 worldPositionOK;varying vec3 normal;float random(in vec2 p) { return fract(sin(dot(p.xy, vec2(12.9898,58.233))) * 43758.5453123); }void main() {normal = aVertexNormal;vec3 vp = vertexPosition;if (isGround==1 && worldPosition.y<2.) { vp.y += (sin(((worldPosition.z+vp.z)*(worldPosition.x+vp.x)*8.+it)/20.)*.1);if (level<=1 || level==12) {vp.y+=.8;}} if (isGround==1 && (level<9 || level==12)) { if (worldPosition.x + vp.x>0. && (worldPosition.x + vp.x < levelSize.y-1.)) {float d = (worldPosition.x + vp.x) * (worldPosition.z + vp.z);vp+=vec3(fract(d/2.)*.1, fract(d/5.)*.1, fract(d/10.)*.1);}if (objectType==4) { vp.y+=.18;}}if (objectType==7) {vp.y-=random(vec2(floor(it/4.0)))*0.2;}v_Vertex_relative_to_light = uPMatrix * u_Shadowmap_transform * vec4(vp.xyz, 1.);gl_Position = uPMatrix * uMVMatrix * vec4(vp,1.);uv = aTextureCoord;localPosition = vp;vec3 directionalLightColor = vec3(.8);if (level==0 || level==1 || level==2) {directionalLightColor = vec3(1.);} else if (level==3 || level==4 || level==5 || level==6) {directionalLightColor = vec3(1., .8, .8);}vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.);vLighting = vec3(1.42) + (directionalLightColor * max(dot(transformedNormal.xyz, vec3(1.,-1.,1.)), .8));worldPositionOK = worldPosition+vertexPosition;}
    </script>
    <script id="vertexShaderShadow" type="x-shader/x-vertex">
      precision mediump int;precision highp float;attribute vec3 vertexPosition;uniform vec3 worldPosition;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;uniform int objectType;uniform int level;uniform vec2 levelSize;uniform float it;void main() {vec3 vp = vertexPosition;if (level<10) {if (worldPosition.x + vp.x>0. && (worldPosition.x + vp.x < levelSize.y-1.)) {float d = (worldPosition.x + vp.x) * (worldPosition.z + vp.z);vp+=vec3(fract(d/2.)*.1, fract(d/5.)*.1, fract(d/10.)*.1);}}if (objectType==4) { vp.y+=.18;}gl_Position = uPMatrix * uMVMatrix * vec4(vp, 1.);}
    </script>
    <script id="fragmentShaderShadow" type="x-shader/x-fragment">
      precision mediump int;precision highp float;void main() {float z = 1.-gl_FragCoord.w*10.;gl_FragColor = vec4(z,0.,0.,1.);}
    </script>
  </head>
  <body onload="init();" onresize="resize()">
    <div style="text-align:left;
    font-size: 30px;
    padding: 5px; "><a href="https://kunjgit.github.io/GameZone/"><i style="color:black;" class="fas fa-home home-icon"></i></a></div>
    <canvas id="game"></canvas><canvas id="HUD"></canvas>
  </body>
</html>
