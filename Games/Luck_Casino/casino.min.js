function isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function CasinoSim(){function n(){var t=new Person;t.init(doorX,doorY,"person");t.personInit();e.push(t)}var e=[];this.casinoGames=[];this.doodads=[];var t=0;this.paused=false;this.cash=5e3;this.popularity=50;this.cursorMode="select";this.creating=0;this.editing=0;this.init=function(){for(var e=0;e<startingAttendance;e++){n()}};this.update=function(){t++;if(this.popularity>100)this.popularity=100;if(this.popularity<0)this.popularity=0;if(this.paused)return true;for(i in e){e[i].update();if(e[i].gone==true){this.removeFromArray(e,e[i])}}for(i in this.casinoGames){this.casinoGames[i].update()}for(i in this.doodads){this.doodads[i].update()}if(this.cash<=0){alert("You have gone bankrupt!");return false}if(t%120==0){var r=Math.random()*100;if(this.popularity>r){n()}}if(Math.random()<1e-4){var s=Math.ceil(this.cash/(Math.random()*10+2));if(Math.random()>.5){alert(goodEvents[Math.floor(Math.random()*2)]+"<br/>You gained $"+s+"!");this.cash+=s}else{alert(badEvents[Math.floor(Math.random()*3)]+"<br/>You lost $"+s+"!");this.cash-=s}}document.getElementById("casinoCash").innerHTML="$"+this.cash;document.getElementById("casinoAttendance").innerHTML=e.length;document.getElementById("casinoPopularity").innerHTML=this.popularity+"%";return true};this.unselectAll=function(){for(i in e){e[i].selected=false;e[i].element.className=e[i].element.className.replace(" selected","")}for(i in this.casinoGames){this.casinoGames[i].selected=false;this.casinoGames[i].element.className=this.casinoGames[i].element.className.replace(" selected","");this.casinoGames[i].beingMoved=false}for(i in this.doodads){this.doodads[i].selected=false;this.doodads[i].element.className=this.doodads[i].element.className.replace(" selected","");this.doodads[i].beingMoved=false}};this.addDoodad=function(){if(10<this.cash){var e=new Doodad;e.init(cursorX,cursorY,"doodad");e.setType(this.creating);this.doodads.push(e);this.cash-=10}else{alert("You will go bankrupt if you place anymore of these.")}};this.addGame=function(){if(gameCosts[this.creating]<this.cash){var e=new CasinoGame;e.init(cursorX,cursorY,"person");e.setType(this.creating);this.casinoGames.push(e);this.cash-=gameCosts[this.creating]}else{alert("You will go bankrupt if you place anymore of these.")}};this.saveCasinoGame=function(){this.editing.winRate=parseFloat(document.getElementById("gameWinRate").value);this.editing.cashOut=parseFloat(document.getElementById("gameCashOut").value);this.editing.costToPlay=parseFloat(document.getElementById("gameCostToPlay").value);hideInfo()};this.setCreateMode=function(e){this.creating=e;this.changeCursor("create")};this.pauseGame=function(){if(this.paused==true){this.paused=false}else{this.paused=true}};this.changeCursor=function(e){this.unselectAll();hideInfo();closeAlert();this.cursorMode=e;document.getElementById("move").className="button";document.getElementById("sell").className="button";document.getElementById("select").className="button";if(e=="move")document.getElementById("move").className="buttonSelected";else if(e=="sell")document.getElementById("sell").className="buttonSelected";else if(e=="select")document.getElementById("select").className="buttonSelected"};this.removeFromArray=function(e,t){index=e.indexOf(t);if(index!=-1){e.splice(index,1)}}}function Entity(){this.element=0;this.selected=false;this.width=16;this.height=16;this.beingMoved=false;this.init=function(e,t,n){this.element=document.createElement("div");if(this.element.className==""){this.element.className=n}else{alert(this.element.className)}e=Math.round(e/16)*16;t=Math.round(t/16)*16;this.setPosition(e,t);casinoDiv.appendChild(this.element);var r=this;this.element.addEventListener("mousedown",function(e){r.onMouseDown(e)},false)};this.setClass=function(e){this.element.className=e};this.setPosition=function(e,t){this.element.style.left=e+"px";this.element.style.top=t+"px";this.element.style.zIndex=t};this.getPosition=function(){var e=parseInt(this.element.style.left,10);var t=parseInt(this.element.style.top,10);return{x:e,y:t}};this.remove=function(){casinoDiv.removeChild(this.element)};this.onMouseMove=function(e){};this.update=function(e){}}function Person(){this.goalX=Math.round(Math.random()*624/16)*16;this.goalY=Math.round(Math.random()*464/16)*16;this.thought="findGameToPlay";this.gone=false;this.gameImPlaying=0;this.playerNumber=0;this.temperament=Math.ceil(Math.random()*3);this.cash=Math.ceil(Math.random()*500);if(Math.random()<casinoSim.popularity/200&&casinoSim.popularity>10){this.cash+=2e3}var e=1;var t=Math.floor(Math.random()*1e3);this.mood=100;this.moving=false;var n={x:0,y:0};var r={horz:0,vert:0};this.personInit=function(){if(Math.random()>.5){this.element.className="person"}else{this.element.className="personFemale"}if(this.cash>500){this.element.className="highRoller";this.temperament=4}};this.onMouseDown=function(e){this.parent.onMouseDown.call(this);if(casinoSim.cursorMode=="select"){showInfo();document.getElementById("gameInfo").style.display="none";document.getElementById("personInfo").style.display="block";document.getElementById("personMood").innerHTML=this.mood+"%";document.getElementById("personCash").innerHTML="$"+this.cash;document.getElementById("personTemp").innerHTML=this.temperament}};this.update=function(){t++;this.element.style.backgroundPosition=-e*this.width+"px 0px";if(this.gameImPlaying!=0){if(this.gameImPlaying.sold==true||this.gameImPlaying.beingMoved==true){this.gameImPlaying.currentPlayers--;this.gameImPlaying=0;this.thought="wandering"}}if(this.mood<=this.temperament*10){this.thought="leave";if(this.gameImPlaying!=0){this.gameImPlaying.currentPlayers--;this.gameImPlaying=0}}if(this.mood>100)this.mood=100;switch(this.thought){case"wandering":this.move();if(this.closeToGoal()){this.goalX=Math.round(Math.random()*624/16)*16;this.goalY=Math.round(Math.random()*464/16)*16;this.thought="findGameToPlay"}if(t%240==0){this.thought="findGameToPlay";this.mood-=this.temperament;}if(this.cash<=5)this.thought="leave";break;case"findGameToPlay":for(var n in casinoSim.casinoGames){if(casinoSim.casinoGames[n].currentPlayers<casinoSim.casinoGames[n].maxPlayers&&casinoSim.casinoGames[n].costToPlay<=this.cash&&casinoSim.casinoGames[n].beingMoved==false){this.gameImPlaying=casinoSim.casinoGames[n];this.thought="movetogame";break}}if(this.gameImPlaying==0){this.thought="wandering";this.mood-=this.temperament;casinoSim.popularity--}break;case"movetogame":this.goalX=this.gameImPlaying.getPosition().x;this.goalY=this.gameImPlaying.getPosition().y;this.move();if(this.gameImPlaying.currentPlayers>=this.gameImPlaying.maxPlayers){this.thought="findGameToPlay";this.goalX=Math.round(Math.random()*624/16)*16;this.goalY=Math.round(Math.random()*464/16)*16;this.gameImPlaying=0}else if(this.closeToGoal()){this.thought="playgame";this.playerNumber=this.gameImPlaying.currentPlayers;this.gameImPlaying.currentPlayers++}break;case"playgame":e=1;if(this.gameImPlaying.height>16)this.setPosition(this.gameImPlaying.getPosition().x+16*this.playerNumber,this.gameImPlaying.getPosition().y+16);else this.setPosition(this.goalX,this.goalY);this.element.style.zIndex=this.gameImPlaying.element.style.zIndex+1;if(t%60==0){this.cash-=this.gameImPlaying.costToPlay;casinoSim.cash+=this.gameImPlaying.costToPlay;if(this.gameImPlaying.didIWin()){casinoSim.cash-=this.gameImPlaying.cashOut;this.cash+=this.gameImPlaying.cashOut;this.mood+=10;if(this.mood>70){casinoSim.popularity+=3}}else this.mood-=this.temperament}if(this.cash<this.gameImPlaying.costToPlay){this.thought="findGameToPlay";this.gameImPlaying.currentPlayers--;this.gameImPlaying=0}break;case"leave":this.goalX=doorX;this.goalY=doorY;this.move();if(this.closeToGoal()){if(this.gone==false){this.remove();if(this.mood>70)casinoSim.popularity++;else casinoSim.popularity-=this.temperament;this.gone=true}}break}};this.findNextBlock=function(n){if(t%12==0){r={horz:0,vert:0};if(n.x>this.goalX){r.horz=-1;e=2}else if(n.x<this.goalX){r.horz=1;e=3}else if(n.y>this.goalY){r.vert=-1;e=1}else if(n.y<this.goalY){r.vert=1;e=0}this.moving=true}else this.moving=false};this.move=function(){var e=this.getPosition();if(e.x%16<1&&e.y%16<1){this.findNextBlock(e);e.x=Math.floor(e.x/16)*16;e.y=Math.floor(e.y/16)*16}if(this.moving==true){e.x+=r.horz;e.y+=r.vert}this.setPosition(e.x,e.y)};this.closeToGoal=function(){var e=this.getPosition();return Math.abs(e.x-this.goalX)<16&&Math.abs(e.y-this.goalY)<16}}function CasinoGame(){var e=0;var t=1;var n=0;this.winRate=.5;this.cashOut=100;this.costToPlay=0;this.upKeep=0;this.maxPlayers=0;this.sold=false;this.currentPlayers=0;this.type="";this.onMouseDown=function(e){this.parent.onMouseDown.call(this);if(casinoSim.cursorMode=="sell"){if(confirm("Do you want to sell this for $"+gameCosts[this.type]/2+"?")){casinoSim.cash+=gameCosts[this.type]/2;this.sold=true;casinoSim.removeFromArray(casinoSim.casinoGames,this);this.remove()}}else if(casinoSim.cursorMode=="select"){showInfo();document.getElementById("gameInfo").style.display="block";document.getElementById("personInfo").style.display="none";casinoSim.editing=this;document.getElementById("gameWinRate").value=this.winRate;document.getElementById("gameCashOut").value=this.cashOut;document.getElementById("gameCostToPlay").value=this.costToPlay;document.getElementById("gameUpKeep").innerHTML="$"+this.upKeep;document.getElementById("gameMaxPlayers").innerHTML=this.maxPlayers}};this.update=function(){n++;if(n%60==0){e++;casinoSim.cash-=this.upKeep}if(e>=frameCount||this.currentPlayers<=0)e=0;this.element.style.backgroundPosition=-e*this.width+"px 0px";if(this.selected==true&&casinoSim.cursorMode=="move"){this.currentPlayers=0;this.setPosition(cursorX,cursorY)}};this.didIWin=function(){var e=Math.random();if(this.winRate<e)return false;else return true};this.setType=function(e){this.setClass(e);this.type=e;switch(e){case"slots":frameCount=1;this.maxPlayers=1;this.upKeep=2;this.costToPlay=3;this.cashOut=10;this.winRate=.05;break;case"roulette":frameCount=2;this.maxPlayers=5;this.width=32;this.height=32;this.upKeep=6;this.costToPlay=25;this.cashOut=50;this.winRate=.2;break;case"blackjack":frameCount=2;this.maxPlayers=3;this.width=32;this.height=32;this.upKeep=3;this.costToPlay=5;this.cashOut=20;this.winRate=.2;break;case"craps":frameCount=2;this.maxPlayers=6;this.width=32;this.height=32;this.upKeep=4;this.costToPlay=15;this.cashOut=25;this.winRate=.3;break;case"poker":frameCount=2;this.maxPlayers=7;this.width=32;this.height=32;this.upKeep=5;this.costToPlay=15;this.cashOut=30;this.winRate=.1;break}}}function Doodad(){var e=0;this.width=16;this.height=16;this.onMouseDown=function(e){this.parent.onMouseDown.call(this);if(casinoSim.cursorMode=="sell"){if(confirm("Do you want to sell this for $5?")){casinoSim.cash+=5;this.remove()}}};this.update=function(){if(e==1)this.element.style.zIndex=0;this.element.style.backgroundPosition=-e*this.width+"px 0px";if(this.selected==true&&casinoSim.cursorMode=="move")this.setPosition(cursorX,cursorY)};this.setType=function(t){e=t}}function showInfo(){var e=document.getElementById("infoBox");e.style.width="500px";e.style.left="300px";e.style.opacity=1;casinoSim.paused=true}function hideInfo(){casinoSim.unselectAll();var e=document.getElementById("infoBox");e.style.width="0px";e.style.left="500px";e.style.opacity=0;casinoSim.paused=false}function closeAlert(){alertDiv=document.getElementById("alert");alertDiv.style.opacity=0;alertDiv.style.width="0px";alertDiv.style.left="500px";document.getElementById("alert").style.opacity=0;casinoSim.paused=false}function StartGame(){casinoSim.init();casinoSim.changeCursor("select");alert("Welcome to Just Your Luck Casino! Here's the quick rundown.  You are the new owner of this dump of a casino.  You need to keep the casino from bankruptcy! To do this you can place various games on the casino floor.  You can also rig these games in order to let customers win just enough to keep them happy and your coffers full.");Run()}function Run(){if(casinoSim.update())requestAnimFrame(Run)}var casinoDiv=document.getElementById("casino");var cursorX=0;var cursorY=0;var somethingAtCursor=false;var maxWidth=parseInt(casinoDiv.style.width,10);var maxHeight=parseInt(casinoDiv.style.height,10);var casinoOffsetX=parseInt(casinoDiv.style.left,10);var casinoOffsetY=parseInt(casinoDiv.style.top,10);var doorX=320;var doorY=450;var startingAttendance=5;var gameCosts=new Array;gameCosts["slots"]=100;gameCosts["blackjack"]=250;gameCosts["craps"]=500;gameCosts["roulette"]=200;gameCosts["poker"]=700;var goodEvents=new Array(2);goodEvents[0]="You have won an award!  Here's your prize!";goodEvents[1]="You are the most fun casino around!  Here's a bonus!";var badEvents=new Array(3);badEvents[0]="Someone broke in and stole money!";badEvents[1]="A slot machine malfunctioned and emptied its contents.";badEvents[2]="A fee is being charged by the state.";casinoDiv.addEventListener("mousemove",function(e){if(e.pageX<maxWidth+casinoOffsetX-16)cursorX=Math.round((e.pageX-casinoOffsetX)/16)*16;if(e.pageY<maxHeight+casinoOffsetY-16)cursorY=Math.round((e.pageY-casinoOffsetY)/16)*16;var t=document.getElementById("cursor");t.style.left=cursorX+"px";t.style.top=cursorY+"px";if(casinoSim.cursorMode=="create"){t.style.display="block"}else{t.style.display="none"}},false);casinoDiv.addEventListener("mousedown",function(e){if(casinoSim.cursorMode=="create"&&cursorX<640&&cursorY<480){for(var t=0;t<casinoSim.casinoGames.length;t++){var n=casinoSim.casinoGames[t].getPosition();if(n.x==cursorX&&n.y==cursorY)return}if(isNumber(casinoSim.creating))casinoSim.addDoodad();else casinoSim.addGame()}if(somethingAtCursor==false){hideInfo();closeAlert();casinoSim.unselectAll()}somethingAtCursor=false},false);Entity.prototype.onMouseDown=function(e){var t=this.getPosition();somethingAtCursor=true;switch(casinoSim.cursorMode){case"select":this.selected=true;this.element.className=this.element.className+" selected";break;case"move":if(this.element.className!="person"){if(this.beingMoved==true){this.selected=false;this.beingMoved=false;this.element.className=this.element.className.replace(" selected","")}else{this.element.className=this.element.className+" selected";this.selected=true;this.beingMoved=true}}break}};Person.prototype=new Entity;Person.prototype.parent=Entity.prototype;CasinoGame.prototype=new Entity;CasinoGame.prototype.parent=Entity.prototype;Doodad.prototype=new Entity;Doodad.prototype.parent=Entity.prototype;window.alert=function(e){alertDiv=document.getElementById("alert");alertDiv.style.opacity=1;alertDiv.style.width="500px";alertDiv.style.left="300px";document.getElementById("alertInner").innerHTML=e;casinoSim.paused=true};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}();var casinoSim=new CasinoSim;StartGame()